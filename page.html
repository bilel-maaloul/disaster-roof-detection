<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOLO Vision — AI Object Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        brand: {
                            50: '#f0f7ff',
                            100: '#e0effe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Inter', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        }
        
        @keyframes fade-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .fade-up { animation: fade-up 0.6s ease-out forwards; }
        .float { animation: float 6s ease-in-out infinite; }
        
        .soft-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 
                        0 10px 15px -3px rgba(0, 0, 0, 0.4);
        }
        
        .soft-shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5),
                        0 25px 50px -12px rgba(0, 0, 0, 0.6);
        }
        
        .upload-border {
            border: 2px dashed #475569;
            transition: all 0.3s ease;
        }
        
        .upload-border:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }
        
        @keyframes progress {
            0% { width: 0%; }
            100% { width: var(--progress); }
        }
        
        .progress-bar {
            animation: progress 1s ease-out forwards;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-0 right-0 w-[600px] h-[600px] bg-blue-900/20 rounded-full mix-blend-lighten filter blur-3xl opacity-30 float"></div>
        <div class="absolute bottom-0 left-0 w-[600px] h-[600px] bg-purple-900/20 rounded-full mix-blend-lighten filter blur-3xl opacity-30 float" style="animation-delay: 2s;"></div>
    </div>

    <div class="relative container mx-auto px-4 py-12 max-w-5xl">
        
        <header class="text-center mb-16 fade-up">
            <div class="inline-flex items-center gap-2 bg-slate-800/80 backdrop-blur-sm px-4 py-2 rounded-full soft-shadow mb-8 border border-slate-700">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span class="text-sm font-medium text-slate-300">Powered by YOLOv8</span>
            </div>
            
            <h1 class="text-5xl md:text-6xl font-extrabold text-white mb-4 tracking-tight">
                AI Object Detection
            </h1>
            
            <p class="text-xl text-slate-400 max-w-2xl mx-auto leading-relaxed">
                Upload an image and instantly detect objects with state-of-the-art computer vision technology
            </p>
        </header>

        <main class="bg-slate-800/50 backdrop-blur-sm rounded-3xl soft-shadow-lg p-8 md:p-12 fade-up border border-slate-700" style="animation-delay: 0.2s;">
            
            <div class="mb-10">
                <label class="block">
                    <div class="upload-border rounded-2xl p-12 cursor-pointer group bg-slate-900/30">
                        <div class="flex flex-col items-center">
                            <div class="w-20 h-20 bg-blue-900/30 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-blue-900/50 group-hover:scale-105 transition-all duration-300 border border-blue-800/50">
                                <svg class="w-10 h-10 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            
                            <h3 class="text-xl font-semibold text-slate-100 mb-2">
                                Drop your image here
                            </h3>
                            <p class="text-slate-400 mb-4">
                                or <span class="text-blue-400 font-medium hover:text-blue-300">browse from your computer</span>
                            </p>
                            <p class="text-sm text-slate-500">
                                Supports PNG, JPG, JPEG, TIF • Max 10MB
                            </p>
                        </div>
                    </div>
                    <input type="file" id="imageInput" accept="image/*" class="hidden">
                </label>

                <div id="uploadStatus" class="hidden mt-4">
                    <div class="bg-gradient-to-r from-blue-900/30 to-sky-900/30 rounded-xl p-4 border border-blue-800/50">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 bg-blue-900/50 rounded-xl flex items-center justify-center flex-shrink-0 border border-blue-700">
                                <svg class="w-5 h-5 text-blue-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M12 2a10 10 0 1010 10A10.011 10.011 0 0012 2z"></path>
                                </svg>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="font-semibold text-slate-100 mb-1">Image updated</h4>
                                <p id="fileName" class="text-sm text-slate-300 truncate"></p>
                                <p id="fileSize" class="text-xs text-slate-500 mt-1"></p>
                            </div>
                            <button onclick="clearUpload()" class="w-8 h-8 bg-slate-700 hover:bg-slate-600 rounded-lg flex items-center justify-center transition-colors">
                                <svg class="w-4 h-4 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-center gap-4 mb-10 flex-wrap">
                <button onclick="detectObjects()" 
                    class="group relative px-10 py-4 bg-blue-600 hover:bg-blue-700 text-white text-lg font-semibold rounded-xl transition-all duration-300 hover:shadow-xl hover:shadow-blue-900/30 hover:-translate-y-0.5 active:translate-y-0">
                    <span class="flex items-center gap-3">
                        <svg class="w-5 h-5 group-hover:rotate-12 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        Detect Objects
                    </span>
                </button>

                <button id="generateReportBtn" onclick="generateReport()" 
                    class="hidden group relative px-10 py-4 bg-purple-600 hover:bg-purple-700 text-white text-lg font-semibold rounded-xl transition-all duration-300 hover:shadow-xl hover:shadow-purple-900/30 hover:-translate-y-0.5 active:translate-y-0">
                    <span class="flex items-center gap-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        Generate AI Report
                    </span>
                </button>
            </div>

            <div id="loading" class="hidden">
                <div class="bg-slate-900/50 rounded-2xl p-10 border border-slate-700">
                    <div class="flex flex-col items-center">
                        <div class="relative w-16 h-16 mb-6">
                            <div class="absolute inset-0 border-4 border-slate-700 rounded-full"></div>
                            <div class="absolute inset-0 border-4 border-transparent border-t-blue-500 rounded-full animate-spin"></div>
                        </div>
                        <h3 id="loadingText" class="text-lg font-semibold text-slate-100 mb-1">Analyzing image...</h3>
                        <p id="loadingSubtext" class="text-slate-400 text-sm">This usually takes a few seconds</p>
                    </div>
                </div>
            </div>

            <div id="preview" class="mb-8"></div>
            <div id="result" class="mb-8"></div>
            <div id="detections"></div>
            <div id="reportSection"></div>
        </main>

        <section class="mt-16 grid grid-cols-1 md:grid-cols-3 gap-6 fade-up" style="animation-delay: 0.4s;">
            <div class="bg-slate-800/40 backdrop-blur-sm rounded-2xl p-6 soft-shadow border border-slate-700">
                <div class="w-12 h-12 bg-blue-900/30 rounded-xl flex items-center justify-center mb-4 border border-blue-800/50">
                    <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <h3 class="font-semibold text-slate-100 mb-2">Lightning Fast</h3>
                <p class="text-slate-400 text-sm">Real-time detection powered by optimized neural networks</p>
            </div>
            
            <div class="bg-slate-800/40 backdrop-blur-sm rounded-2xl p-6 soft-shadow border border-slate-700">
                <div class="w-12 h-12 bg-purple-900/30 rounded-xl flex items-center justify-center mb-4 border border-purple-800/50">
                    <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                    </svg>
                </div>
                <h3 class="font-semibold text-slate-100 mb-2">Highly Accurate</h3>
                <p class="text-slate-400 text-sm">State-of-the-art YOLOv8 model with exceptional precision</p>
            </div>
            
            <div class="bg-slate-800/40 backdrop-blur-sm rounded-2xl p-6 soft-shadow border border-slate-700">
                <div class="w-12 h-12 bg-green-900/30 rounded-xl flex items-center justify-center mb-4 border border-green-800/50">
                    <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
                <h3 class="font-semibold text-slate-100 mb-2">Secure & Private</h3>
                <p class="text-slate-400 text-sm">Your images are processed locally and never stored</p>
            </div>
        </section>

        <footer class="text-center mt-12 text-slate-500 text-sm">
            <p>Built with YOLOv8 • Tailwind CSS • OpenAI</p>
        </footer>
    </div>

    <script>
        // ⚠️ WARNING: Never expose API keys in frontend code for production!
        // Use a backend proxy instead. This is for local testing only.
        const OPENAI_API_KEY = 'key here'; // Replace with your new key
        
        let lastDetectionResults = null;
        let lastFileName = '';

        async function detectObjects() {
            const input = document.getElementById('imageInput');
            if (!input.files[0]) {
                showNotification('Please select an image first', 'warning');
                return;
            }

            lastFileName = input.files[0].name;
            showLoading('Analyzing image...', 'This usually takes a few seconds');
            document.getElementById('result').innerHTML = '';
            document.getElementById('detections').innerHTML = '';
            document.getElementById('reportSection').innerHTML = '';
            document.getElementById('generateReportBtn').classList.add('hidden');

            const formData = new FormData();
            formData.append('image', input.files[0]);

            try {
                const response = await fetch('http://localhost:5000/predict', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error(`Server error: ${response.status}`);

                const data = await response.json();
                hideLoading();
                
                lastDetectionResults = data;
                
                document.getElementById('result').innerHTML = `
                    <div class="rounded-2xl overflow-hidden soft-shadow-lg border border-slate-700">
                        <img src="${data.image}" class="w-full" alt="Detection Result">
                    </div>
                `;
                
                if (data.count > 0) {
                    let html = `
                        <div class="mt-8 bg-gradient-to-br from-green-900/30 to-emerald-900/30 rounded-2xl p-6 border border-green-800/50">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-10 h-10 bg-green-900/50 rounded-full flex items-center justify-center border border-green-700">
                                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-slate-100">
                                        ${data.count} object${data.count !== 1 ? 's' : ''} detected
                                    </h3>
                                    <p class="text-sm text-slate-400">Analysis complete</p>
                                </div>
                            </div>
                            <div class="space-y-3">
                    `;
                    
                    data.detections.forEach((det, i) => {
                        const confidence = (det.confidence * 100).toFixed(1);
                        const colorClass = confidence > 80 ? 'bg-green-500' : confidence > 50 ? 'bg-blue-500' : 'bg-yellow-500';
                        html += `
                            <div class="bg-slate-800/80 rounded-xl p-4 soft-shadow border border-slate-700">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-3">
                                        <span class="w-8 h-8 bg-slate-700 rounded-lg flex items-center justify-center text-sm font-medium text-slate-300">${i+1}</span>
                                        <span class="font-semibold text-slate-100">${det.class}</span>
                                    </div>
                                    <span class="text-sm font-medium text-slate-300">${confidence}%</span>
                                </div>
                                <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                                    <div class="${colorClass} h-full rounded-full transition-all duration-700 progress-bar" style="--progress: ${confidence}%"></div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `</div></div>`;
                    document.getElementById('detections').innerHTML = html;
                    
                    // Show generate report button
                    document.getElementById('generateReportBtn').classList.remove('hidden');
                } else {
                    document.getElementById('detections').innerHTML = `
                        <div class="mt-8 bg-amber-900/30 rounded-2xl p-6 border border-amber-800/50 text-center">
                            <div class="w-12 h-12 bg-amber-900/50 rounded-full flex items-center justify-center mx-auto mb-4 border border-amber-700">
                                <svg class="w-6 h-6 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            </div>
                            <h3 class="font-semibold text-slate-100 mb-1">No objects detected</h3>
                            <p class="text-slate-400 text-sm">Try uploading a different image</p>
                        </div>
                    `;
                }
                
                showNotification('Detection completed successfully!', 'success');
                
            } catch (error) {
                hideLoading();
                document.getElementById('result').innerHTML = `
                    <div class="bg-red-900/30 rounded-2xl p-6 border border-red-800/50">
                        <div class="flex items-start gap-4">
                            <div class="w-10 h-10 bg-red-900/50 rounded-full flex items-center justify-center flex-shrink-0 border border-red-700">
                                <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </div>
                            <div>
                                <h3 class="font-semibold text-slate-100 mb-1">Connection Error</h3>
                                <p class="text-slate-300 text-sm mb-2">${error.message}</p>
                                <p class="text-slate-400 text-xs">Make sure the Flask server is running on port 5000</p>
                            </div>
                        </div>
                    </div>
                `;
                showNotification('Error: ' + error.message, 'error');
            }
        }

        async function generateReport() {
            if (!lastDetectionResults || lastDetectionResults.count === 0) {
                showNotification('No detection results available', 'warning');
                return;
            }

            if (OPENAI_API_KEY === 'YOUR_API_KEY_HERE') {
                showNotification('Please configure your OpenAI API key', 'error');
                return;
            }

            showLoading('Generating AI Report...', 'GPT-4o-mini is analyzing your results');

            const detectionSummary = lastDetectionResults.detections.map((det, i) => 
                `${i + 1}. ${det.class} (Confidence: ${(det.confidence * 100).toFixed(1)}%)`
            ).join('\n');

            const prompt = `You are a disaster response specialist analyzing aerial imagery from rural Malawi to support emergency planning and humanitarian response. Based on the roof types detected in this drone imagery, generate a comprehensive disaster preparedness and response report.

**DETECTION SUMMARY**
Image File: ${lastFileName}
Total Structures Detected: ${lastDetectionResults.count}
Analysis Date: ${new Date().toLocaleString()}

**Detected Roof Types:**
${detectionSummary}

**CONTEXT**: Rural Malawi faces recurring natural disasters including floods, droughts, and landslides. Over 80% of Malawians live in rural areas where many homes have traditional grass-thatch roofs. These structures are particularly vulnerable to disasters and are often missed in satellite-based population assessments, leading to inadequate emergency response.

Please generate a professional disaster planning report that includes:

1. **Executive Summary**
   - Overview of detected structures and their disaster vulnerability
   - Critical risk assessment for this area

2. **Roof Type Analysis & Vulnerability Assessment**
   - Detailed breakdown of each roof type detected (thatch, tin, other)
   - Specific vulnerabilities of each roof type to floods, winds, and storms
   - Population estimation based on structure count
   - Structural resilience ratings

3. **Disaster Risk Profile**
   - Flood susceptibility based on roof types
   - Wind/storm damage likelihood
   - Fire risk (especially for thatch roofs)
   - Secondary hazards (landslides, water-borne diseases)

4. **Emergency Response Recommendations**
   - Evacuation priority zones based on roof vulnerability
   - Pre-positioning of relief supplies (shelter materials, food, medical)
   - Access routes and logistics planning
   - Emergency shelter requirements

5. **Preparedness & Mitigation Strategies**
   - Community early warning system recommendations
   - Roof reinforcement programs for vulnerable structures
   - Transitional shelter planning
   - Resource allocation priorities

6. **Aid Distribution Planning**
   - Estimated affected population if disaster strikes
   - Required emergency supplies (tarpaulins, shelter kits, etc.)
   - Distribution center locations
   - Timeline for rapid response

7. **Long-term Resilience Building**
   - Infrastructure improvement recommendations
   - Community capacity building initiatives
   - Roof upgrade programs
   - Climate adaptation strategies

Format the report professionally with specific, actionable recommendations suitable for humanitarian organizations, government agencies, and disaster response teams.`;


            

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            { role: 'system', content: 'You are a professional technical report writer specializing in computer vision and object detection analysis.' },
                            { role: 'user', content: prompt }
                        ],
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API error: ${response.status}`);
                }

                const data = await response.json();
                const reportContent = data.choices[0].message.content;
                
                hideLoading();
                displayReport(reportContent);
                showNotification('Report generated successfully!', 'success');

            } catch (error) {
                hideLoading();
                showNotification('Error generating report: ' + error.message, 'error');
            }
        }

        function displayReport(content) {
            const reportHtml = `
                <div class="mt-8 bg-gradient-to-br from-purple-900/30 to-indigo-900/30 rounded-2xl p-6 border border-purple-800/50">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-purple-900/50 rounded-full flex items-center justify-center border border-purple-700">
                                <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-slate-100">AI Generated Report</h3>
                                <p class="text-sm text-slate-400">Powered by GPT-4o-mini</p>
                            </div>
                        </div>
                        <button onclick="downloadReport()" 
                            class="flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                            </svg>
                            Download Report
                        </button>
                    </div>
                    <div id="reportContent" class="bg-slate-900/50 rounded-xl p-6 border border-slate-700 max-h-[500px] overflow-y-auto">
                        <pre class="whitespace-pre-wrap text-slate-300 text-sm leading-relaxed font-sans">${escapeHtml(content)}</pre>
                    </div>
                </div>
            `;
            
            document.getElementById('reportSection').innerHTML = reportHtml;
            
            // Store report for download
            window.currentReport = content;
        }

        function downloadReport() {
            if (!window.currentReport) {
                showNotification('No report available to download', 'warning');
                return;
            }

            const header = `YOLO Vision - Object Detection Report
Generated: ${new Date().toLocaleString()}
File: ${lastFileName}
${'='.repeat(50)}

`;
            const fullReport = header + window.currentReport;
            
            const blob = new Blob([fullReport], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `detection_report_${Date.now()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Report downloaded!', 'success');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showLoading(title, subtitle) {
            document.getElementById('loadingText').textContent = title;
            document.getElementById('loadingSubtext').textContent = subtitle;
            document.getElementById('loading').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        const imageInput = document.getElementById('imageInput');

        imageInput.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function (ev) {};
            reader.readAsDataURL(file);

            showUploadStatus(file);
            showNotification('Image updated', 'success');
            
            // Reset report when new image is uploaded
            document.getElementById('reportSection').innerHTML = '';
            document.getElementById('generateReportBtn').classList.add('hidden');
            lastDetectionResults = null;
        });

        function showUploadStatus(file) {
            const statusDiv = document.getElementById('uploadStatus');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');

            const size = file.size;
            const sizeStr = size < 1024 * 1024
                ? (size / 1024).toFixed(1) + ' KB'
                : (size / (1024 * 1024)).toFixed(2) + ' MB';

            fileName.textContent = file.name;
            fileSize.textContent = `Size: ${sizeStr}`;

            statusDiv.classList.remove('hidden');
            statusDiv.style.opacity = '0';
            statusDiv.style.transform = 'translateY(-10px)';
            setTimeout(() => {
                statusDiv.style.transition = 'all 0.25s ease-out';
                statusDiv.style.opacity = '1';
                statusDiv.style.transform = 'translateY(0)';
            }, 10);
        }

        function clearUpload() {
            imageInput.value = '';
            document.getElementById('uploadStatus').classList.add('hidden');
            document.getElementById('preview').innerHTML = '';
            document.getElementById('result').innerHTML = '';
            document.getElementById('detections').innerHTML = '';
            document.getElementById('reportSection').innerHTML = '';
            document.getElementById('generateReportBtn').classList.add('hidden');
            lastDetectionResults = null;
            showNotification('Image cleared', 'warning');
        }

        const uploadArea = document.querySelector('.upload-border');
        
        ['dragenter', 'dragover'].forEach(event => {
            uploadArea.addEventListener(event, (e) => {
                e.preventDefault();
                uploadArea.classList.add('border-blue-500', 'bg-blue-900/20');
            });
        });
        
        ['dragleave', 'drop'].forEach(event => {
            uploadArea.addEventListener(event, (e) => {
                e.preventDefault();
                uploadArea.classList.remove('border-blue-500', 'bg-blue-900/20');
            });
        });
        
        uploadArea.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            if (files.length) {
                imageInput.files = files;
                imageInput.dispatchEvent(new Event('change'));
            }
        });

        function showNotification(message, type) {
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-amber-600'
            };
            
            const icons = {
                success: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>',
                error: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>',
                warning: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01"></path>'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed bottom-6 right-6 ${colors[type]} text-white px-5 py-3 rounded-xl shadow-lg flex items-center gap-3 z-50 transform transition-all duration-300`;
            notification.innerHTML = `
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">${icons[type]}</svg>
                <span class="font-medium">${message}</span>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(20px)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
